\subsection{REST Schnittstelle}
\label{sec:rest-schnittstelle}
Die Schnittstelle von der externen Steuereinheit zum Raspberry Pi wird über eine REST\footnote{Representational State Transfer}-Schnittstelle realisiert. Es wurden folgende Ressourcen definiert:
\begin{itemize}
	\item start
	\item camera
	\item drive
	\item logger
\end{itemize}
Jede Ressource lässt sich mit HTTP-Methoden (GET, PUT, POST usw.) abrufen oder verändern. Die Schnittstelle lässt sich ohne Authentifizierung nutzen und arbeiten mit dem JSON-Datenformat. Nachfolgend werden die einzelnen Ressourcen näher beschrieben.


\subsubsection{PUT start}
Diese Anfrage startet den Wurf-Vorgang und ist blockierend. Es müssen keine Parameter übergeben werden.\\
 
\textbf{Beispiel Request}

\texttt{PUT}
\texttt{http://<raspberrypi-ip>/start}

\begin{lstlisting}[caption=PUT start Request, tabsize=2]
{}
\end{lstlisting}

\textbf{Beispiel Result}

\begin{lstlisting}[caption=PUT start Response, tabsize=2]
HTTP/1.1 200 OK
Content-Type: text/plain
\end{lstlisting}





\subsubsection{GET camera}
Diese Anfrage liefert die aktuellen Einstellungen der Bilderkennung zurück.\\

\textbf{Parameter}

\begin{tabular}{l p{16cm}}
	\texttt{config} & Die Konfiguration der Bilderkennung \\
	\texttt{line\_y} & Die Pixellinie welche analysiert werden soll um den Korb zu detektieren. \\
	\texttt{line\_h} & Bei der Detektierung wird nicht nur eine Pixellinie untersucht. Mit \texttt{area} kann ein Band definiert werden in dem die Linien analysiert werden. \\
	\texttt{greyscale\_threshold} & Schwellenwert der Objekterkennung. \\
	\texttt{greyscale} & \texttt{true} wenn ein Graustufen-Bild erzeugt werden soll. \\
	\texttt{quality} & Ein Wert zwischen 0 und 100 für die Qualität des JPEG-Bildes. \\
	\texttt{crop\_x} & Breite des Feldes das auf beiden Seiten des Bildes abgeschnitten wird. \\
	\texttt{contrast} & Ein Wert zwischen -100 und 100 für den Kontrast der Kamera. \\
\end{tabular}\\

\textbf{Beispiel Request}

\texttt{GET} 
\texttt{http://<raspberrypi-ip>/camera}\\

\textbf{Beispiel Result}

\begin{lstlisting}[caption=GET camera Result, label=lst:camera, tabsize=2]
{
	"config": {
		"line_y": 0, 
		"line_h": 1, 
		"greyscale_threshold": 0,
		"greyscale": true, 
		"quality": 90, 
		"crop_x": 0, 
		"contrast": 10, 
	}
}
\end{lstlisting}

\subsubsection{PUT camera}

Diese Anfrage verändert die Einstellungen der Bilderkennung.\\

\textbf{Beispiel Request}

\texttt{PUT}
\texttt{http://<raspberrypi-ip>/camera} \\
Body siehe Listing \ref{lst:camera}\\

\textbf{Beispiel Result}

\texttt{HTTP/1.1 200 OK} \\
\texttt{Content-Type: text/json} \\

\noindent
Wenn kein valides JSON übergeben wurde: \\

\noindent
\texttt{HTTP/1.1 406 NOT ACCEPTABLE} \\
\texttt{Content-Type: text/json}


\subsubsection{POST camera}

Diese Anfrage erzeugt ein neues Bild und lässt die Detektierung laufen. Es sind keine Parameter notwendig. \\

\textbf{Beispiel Request}

\texttt{POST}
\texttt{http://<raspberrypi-ip>/camera} \\
\begin{lstlisting}[caption=POST camera Request, tabsize=2]
{}
\end{lstlisting}

\textbf{Beispiel Result}
\begin{lstlisting}[caption=POST camera Response, tabsize=2]
HTTP/1.1 200 OK
Content-Type: text/plain
\end{lstlisting}



\subsubsection{POST bldc}

Für den BLDC gibt es drei Ressourcen. bldc/start, bldc/stop und bldc/reset. Reset und Stop benötigen keine Parameter. Alle Responses sind empty. Für start braucht es den RPM (Rounds per Minute) Wert des Schwungrades. Der RPM Wert muss zwischen 4000 und 20000 liegen.

\textbf{Beispiel Request}

\texttt{POST}
\texttt{http://<raspberrypi-ip>/bldc/start} \\
\begin{lstlisting}[caption=POST bldc/start Request, tabsize=2]
{
    rpm: 5000
}
\end{lstlisting}

\textbf{Beispiel Result}
\begin{lstlisting}[caption=POST bldc/start Response, tabsize=2]
HTTP/1.1 200 OK
Content-Type: text/plain
\end{lstlisting}




\subsubsection{POST dc}

Für den DC gibt es vier Ressourcen: dc/forward, dc/backward, dc/stop und dc/reset. Alle Request verlangen keine Parameter und alle Response sind leer

\textbf{Beispiel Request}

\texttt{POST}
\texttt{http://<raspberrypi-ip>/bldc/*} \\
\begin{lstlisting}[caption=POST dc/* Request, tabsize=2]
{
}
\end{lstlisting}

\textbf{Beispiel Result}
\begin{lstlisting}[caption=POST dc/* Response, tabsize=2]
HTTP/1.1 200 OK
Content-Type: text/plain
\end{lstlisting}




\subsubsection{POST stp}

Für den STP gibt es zwei Ressourcen: stp/start und stp/reset. Der Reset Request verlangt keine Parameter. Alle Responses sind leer. Die Start-Resource verlangt die Steps, welcher der Stepper durchführen muss. Negativ ist eine Linksdrehung, positiv ist eine Rechtsdrehung.

\textbf{Beispiel Request}

\texttt{POST}
\texttt{http://<raspberrypi-ip>/stp/start} \\
\begin{lstlisting}[caption=POST stp/start Request, tabsize=2]
{
   steps: 432
}
\end{lstlisting}

\textbf{Beispiel Result}
\begin{lstlisting}[caption=POST stp/start Response, tabsize=2]
HTTP/1.1 200 OK
Content-Type: text/plain
\end{lstlisting}







\subsubsection{GET logger}

Diese Anfrage liefert das Log-File des Server zurück.\\

\textbf{Beispiel Request}

\texttt{GET} 
\texttt{http://<raspberrypi-ip>/logger}\\

\textbf{Beispiel Result}

\begin{lstlisting}[caption=POST camera Response, tabsize=2]
HTTP/1.1 200 OK
Content-Type: text/plain
15.05.2015 15:16:33 INFO Starte Prozess
15.05.2015 15:16:34 INFO Richte Stepper aus
15.05.2015 15:16:39 INFO Starte BLDC
15.05.2015 15:16:59 INFO Ballnachschub starten
15.05.2015 15:18:02 INFO Prozess beendet
\end{lstlisting}

